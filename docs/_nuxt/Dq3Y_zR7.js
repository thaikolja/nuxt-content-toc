import{a9 as j,j as V,I as M,r as A,l as q,v as y,aa as D,U as $,p as L,h as N,c as g,a as T,t as I,ab as B,ac as E,R as K,o as C,K as k}from"./a7acGgKN.js";import{_ as F}from"./DlAUqK2U.js";async function U(){if(typeof globalThis<"u"){const e=globalThis;return{queryCollection:e.queryCollection,queryContent:e.queryContent}}return null}function z(e,t){return Array.isArray(e)?e.filter(i=>t.includes(i.depth??0)).map(i=>({id:i.id,depth:i.depth??0,text:i.text,children:i.children?z(i.children,t):void 0})):[]}function S(e,t,i=2){return Array.isArray(e)?e.map(n=>{const o=n.depth??n.level??i;if(!t.includes(o))return null;const u=n.children?S(n.children,t,i+1):void 0;return{id:n.id,depth:o,text:n.text,...u?.length?{children:u}:{}}}).filter(n=>n!==null):[]}function H(e){const t=[];for(const i of e)t.push(i.id),i.children&&t.push(...H(i.children));return t}function Y(e){const t=j(),n=(M().public.contentToc||{}).levels||[2,3,4],o=A([]),u=A(!0),f=A(null),h=q(()=>H(o.value));async function _(){u.value=!0,f.value=null;try{const s=y(e);if(typeof s=="object"&&s!==null){const r=s,w=r.body?.toc?.links||r.toc?.links;Array.isArray(w)?o.value=S(w,n):o.value=[];return}const d=(typeof s=="string"?s:void 0)||t.path,l=await U();if(l?.queryCollection){const r=await l.queryCollection("content").path(d).first();r?.body?.toc?.links?o.value=S(r.body.toc.links,n):r?.toc?.links?o.value=S(r.toc.links,n):o.value=[]}else if(l?.queryContent){const r=await l.queryContent(d).findOne();r?.body?.toc?.links?o.value=z(r.body.toc.links,n):o.value=[]}else o.value=[]}catch(s){f.value=s instanceof Error?s:new Error("Failed to fetch TOC"),o.value=[]}finally{u.value=!1}}async function x(){await _()}return V([()=>t.path,()=>D(e)?e.value:e],()=>{_()},{immediate:!0}),{toc:o,headingIds:h,pending:u,error:f,refresh:x}}function P(e,t={}){const m=M().public.contentToc||{},n=t.offsetTop??m.scrollOffset??80,o=q(()=>t.rootMargin??`-${n}px 0px -80% 0px`),u=A(null);let f=null;const h=new Map;function _(){if(h.size===0)return;const s=[...h.entries()].sort(([,d],[,l])=>{const r=d.boundingClientRect,w=l.boundingClientRect;return r.top-w.top}).map(([d])=>d);s.length>0&&(u.value=s[0]||null)}function x(){if(f&&(f.disconnect(),h.clear()),e.value.length===0){u.value=null;return}f=new IntersectionObserver(s=>{for(const d of s){const l=d.target.id;d.isIntersecting?h.set(l,d):h.delete(l)}_()},{rootMargin:o.value,threshold:[0,.5,1]});for(const s of e.value){const d=document.getElementById(s);d&&f.observe(d)}e.value.length>0&&!u.value&&(u.value=e.value[0]||null)}return $(async()=>{await L(),x()}),N(()=>{f&&(f.disconnect(),f=null),h.clear()}),V([e,o],async()=>{await L(),x()},{deep:!0}),u}const G=["aria-label"],J={class:"sr-only"},Q={class:"toc-list"},W=["href","aria-current","onClick","onKeydown"],X=["href","aria-current","onClick","onKeydown"],Z=["href","aria-current","onClick","onKeydown"],ee={key:1,class:"toc-loading"},te={key:2,class:"toc-error",role:"alert"},ne={__name:"TableOfContents",props:{levels:{type:Array,required:!1,default:void 0},activeClass:{type:String,required:!1,default:void 0},itemClass:{type:String,required:!1,default:void 0},sublistClass:{type:String,required:!1,default:void 0},sublistItemClass:{type:String,required:!1,default:void 0},scrollOffset:{type:Number,required:!1,default:void 0},path:{type:String,required:!1,default:void 0},ariaLabel:{type:String,required:!1,default:"Table of Contents"},page:{type:[Object,null],required:!1,default:void 0}},setup(e){const t=e,m=M().public.contentToc,n=q(()=>t.activeClass??m?.activeClass??"toc-active"),o=q(()=>t.itemClass??m?.itemClass??"toc-item"),u=q(()=>t.sublistClass??m?.sublistClass??"toc-sublist"),f=q(()=>t.sublistItemClass??m?.sublistItemClass??"toc-sublist-item"),h=q(()=>t.scrollOffset??m?.scrollOffset??80),{toc:_,headingIds:x,pending:s,error:d}=Y(t.page||t.path),l=P(x,{offsetTop:h.value});function r(v){return l.value===v.id?!0:v.children?v.children.some(p=>r(p)):!1}function w(v,p){v.preventDefault();const c=document.getElementById(p);if(c){const a=c.getBoundingClientRect().top+window.scrollY-h.value;window.scrollTo({top:a,behavior:"smooth"}),history.pushState(null,"",`#${p}`)}}function R(v,p){(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),w(v,p))}return $(()=>{const v=window.location.hash.slice(1);v&&setTimeout(()=>{const p=document.getElementById(v);if(p){const c=p.getBoundingClientRect().top+window.scrollY-h.value;window.scrollTo({top:c,behavior:"smooth"})}},100)}),(v,p)=>!y(s)&&y(_).length>0?(C(),g("nav",{key:0,"aria-label":e.ariaLabel,role:"navigation",class:"toc-container"},[T("span",J,I(e.ariaLabel),1),T("ul",Q,[(C(!0),g(B,null,E(y(_),c=>(C(),g("li",{key:c.id,class:k([o.value,{[n.value]:r(c)}])},[T("a",{href:`#${c.id}`,class:k(["toc-link",{[n.value]:y(l)===c.id}]),"aria-current":y(l)===c.id?"location":void 0,onClick:a=>w(a,c.id),onKeydown:a=>R(a,c.id)},I(c.text),43,W),c.children&&c.children.length>0?(C(),g("ul",{key:0,class:k(u.value)},[(C(!0),g(B,null,E(c.children,a=>(C(),g("li",{key:a.id,class:k([f.value,{[n.value]:r(a)}])},[T("a",{href:`#${a.id}`,class:k(["toc-link",{[n.value]:y(l)===a.id}]),"aria-current":y(l)===a.id?"location":void 0,onClick:b=>w(b,a.id),onKeydown:b=>R(b,a.id)},I(a.text),43,X),a.children&&a.children.length>0?(C(),g("ul",{key:0,class:k(u.value)},[(C(!0),g(B,null,E(a.children,b=>(C(),g("li",{key:b.id,class:k([f.value,{[n.value]:y(l)===b.id}])},[T("a",{href:`#${b.id}`,class:k(["toc-link",{[n.value]:y(l)===b.id}]),"aria-current":y(l)===b.id?"location":void 0,onClick:O=>w(O,b.id),onKeydown:O=>R(O,b.id)},I(b.text),43,Z)],2))),128))],2)):K("",!0)],2))),128))],2)):K("",!0)],2))),128))])],8,G)):y(s)?(C(),g("div",ee,[...p[0]||(p[0]=[T("span",{class:"sr-only"},"Loading table of contents...",-1)])])):y(d)?(C(),g("div",te,[...p[1]||(p[1]=[T("span",{class:"sr-only"},"Error loading table of contents",-1)])])):K("",!0)}},le=F(ne,[["__scopeId","data-v-99acfb80"]]);export{le as default};
